# 스프링 부트 핵심 가이드



![img](https://blog.kakaocdn.net/dn/bJJ3D3/btssqoekp8J/uTvDVCplhFeMZrvTjcB0aK/img.png)





# [스프링 부트 핵심 가이드] Chapter 8장. Spring Data JPA 활용





## JPQL

> #### JPA Query Language의 줄임말로 JPA에서 사용할 수 있는 쿼리를 의미한다
>
> - JPQL은 엔티티 객체를 대상으로 수행하는 쿼리다





## 쿼리 메서드



#### 주로 Repository라는 패키지를 만들어서, 그 안에 Repository 인터페이스를 만든다



#### 그리고 인터페이스는 JpaRepository 클래스를 상속 받아서 다양한 CRUD 메서드를 사용할 수 있다



#### 쿼리 메서드는 크게 동작을 결정하는 주제 (Subject)와 서술어 (Predicate)로 구분한다

- 'find.... By', 'exists... By'와 같은 키워드로 쿼리 주제를 정하며 'By'는 서술어의 시작을 나타내는 구분자 역할을 한다



```java
// (리턴 타입) + {주제 + 서술어(속성)}
List<ClassExample> findByNameOrAge(String name, int age);
```



#### 조회 키워드

- **find...By** | **read...By** | **get...By** | **query...By** | **search...By** | **stream...By**

```java
Optional<ClassExample> findByName(String name);
List<ClassExample> findAllByName(String name);
ClassExample findByName(String name);
```



#### exists... By

- 특정 데이터가 존재하는지 확인하는 키워드 (리턴 타입으로 boolean 타입을 사용해야 한다)

```java
boolean existsByName(String name);
```



#### count...By

- 조회 쿼리를 수행한 후 쿼리 결과로 나온 데이터의 개수를 리턴한다

```java
long countByName(String name);
```



#### delete...By, remove...By

- 삭제 쿼리를 수행한다
- 리턴 타입이 없거나 삭제한 횟수를 리턴한다

```java
void deleteByName(String name);
long removeByName(String name);
```





#### ...First{number}..., ...Top{number}...

- 조회된 결과값의 개수를 제한한느 키워드다
- 한 번의 동작으로 여러 건을 조회할 때 사용되며, 단 건으로 조회하기 위해서는 {number}를 생략하면 된다

```java
List<ClassExample> findFirst5ByName(String name);
List<ClassExmple> findTop10ByName(String name);
```





### 쿼리 메서드의 조건자 키워드



#### Is

- 값의 일치를 조건으로 사용하는 조건자 키워드다
- 생략되는 경우가 많으며 Equals와 동일한 기능을 수행한다

```java
ClassExample findByNumberIs(Long number);
ClassExample findByNameEquals(String name);
```



#### (Is)Not

- 값의 불일치를 조건으로 사용하는 키워드다
- Is는 생략하고 Not 키워드만 사용할 수 있다

```java
ClassExample findByNameIsNot(String name);
ClassExample findByNumberNot(Long number);
```



#### (Is)Null, (Is)NotNull

- 값이 null인지 검사하는 조건자 키워드다

```java
List<ClassExample> findByCountryNull();
List<ClassExample> findByCountryIsNull();
List<ClassExample> findByPetNotNull();
List<ClassExample> findByPetIsNotNull();
```



#### (Is)True, (Is)False

- boolean 타입으로 지정된 칼럼값을 확인하는 키워드다
- 엔티티 안에 boolean 타입을 사용하는 칼럼이 없으면, 사용을 못 한다

```java
ClassExample findByCheckedTrue();
ClassExample findByCheckedIsTrue();
ClassExample findByCheckedFalse();
ClassExample findByCheckedIsFalse();
```



#### And, Or

- 여러 조건을 묶을 때 사용한다

```java
ClassExample findByNameAndCountry(String name, String country);
ClassExample findByNameOrCountry(String name, String country);
```



#### (Is)GreaterThan, (Is)LessThan, (Is)Between

- 숫자나 datetime 칼럼을 대상으로 비교 연산에 사용할 수 있는 조건자 키워드다
- GreaterThan, LessThan 키워드는 비교 대상에 대한 초과/미만의 개념이고, 경계값을 포함하려면 Equal 키워드를 추가하면 된다

```java
List<ClassName> findByAgeGreaterThan(Long age);				//초과
List<ClassName> findByAgeIsGreaterThan(Long age);			//초과	
List<ClassName> findByAgeIsGreaterThanEqual(Long age);		//이상
List<ClassName> findByAgeIsLessThan(Long age);				//미만
List<ClassName> findByAgeLessThan(Long age);				//미만
List<ClassName> findByAgeLessThanEqual(Long age);			//이하
List<ClassName> findByAgeIsBetween(Long age1, Long age2);
List<ClassName> findByAgeBetween(Long age1, Long age2);
```



#### (Is)StartingWith(==StartsWith), (Is)EndingWith(==EndsWith), (Is)Containing(==Contains), (Is)Like

- 칼럼값에서 일부 일치 여부를 확인하는 조건자 키워드다
- StartingWith 또는 StartsWith는 문자열 앞
- EndingWith 또는 EndsWith는 문자열 뒤
- Containing 또는 Contains는 문자열 안에 포함이 되어 있는지에 대한 여부
- Like는 코드 수준에서 메서드를 호출하면서 전달하는 값에 %를 명시적으로 입력해야 한다

```java
List<ClassName> findByNameLike(String name);
List<ClassName> findByNameIsLike(String name);
List<ClassName> findByCountryContains(String country);
List<ClassName> findByCountryContaining(String country);
List<ClassName> findByCountryIsContaining(String country);
List<ClassName> findByCompanyStartsWith(String company);
List<ClassName> findByCompanyStartingWith(String company);
List<ClassName> findByCompayIsStartingWith(String company);
List<ClassName> findByUserNameEndsWith(String userName);
List<ClassName> findByUserNameEndingWith(String userName);
List<ClassName> findByUserNameIsEndingWith(String userName);
```





## 정렬과 페이징 처리



#### 정렬을 말 그대로 정렬이고, 페이징은 특히 어플리케이션에 많이 사용이된다

- 한 페이지에 너무 많은 데이터가 있을 때에, 한 화면에 모든 데이터를 띄우면 어플리케이션이 정돈이 잘 안 된 것 처럼 보일 수 있다
- 페이징을 통해, 한 페이지 당 몇 개의 데이터를 보일지 정할 수 있다



#### 정렬

- OrderBy를 사용하고, 오름차순이 기본이면 내림차순으로도 바꿀 수 있다
  - ASC : 오름차순
  - DESC : 내림차순

```java
List<ClassName> findByNameOrderByAgeAsc(String name);
List<ClassName> findByNameOrderByAgeDesc(String name);
```



- 여러 개를 정렬할 수 있다 (And를 꼭 안 붙여도 된다)

```java
List<ClassName> findByNameOrderByAgeAscNumberDesc(String name);
```



- 가독성을 위해 매개변수를 활요해 정렬할 수 있다

```java
List<ClassName> findByName(String name, Sort.by(Order.asc("age"), Order.desc("number")));
```



#### 페이징 처리

- 데이터베이스의 레코드를 개수로 나눠 페이지를 구분하는 것
- Page와 Pageable을 사용한다

```java
// PlayerRepository
Page<Player> findByName(String name, Pageable pageable);
```



```java
// PlayerRepositoryTest
PlayerRepository playerRepository;

Page<Player> playerPage = playerRepository.findByName("Alex", pageRequest.of(0,2));

System.out.println(playerPage.getContent());
```

- .getContent() 메서드를 사용하면, 배열 형태로 값이 출력된다



| of 메서드                                               | 매개변수 설명                                             | 비고                                       |
| ------------------------------------------------------- | --------------------------------------------------------- | ------------------------------------------ |
| of(int page, int size)                                  | 페이지 번호 (0부터ㅅ 시작), 페이지당 데이터 개수          | 데이터를 정렬하지 않음                     |
| of(int page, int size, Sort)                            | 페이지 번호, 페이지당 데이터 개수, 정렬                   | Sort에 의해 정렬                           |
| of(int page, int size, Direstion, String... properties) | 페이지 번호, 페이지당 데이터 개수, 정렬 방향, 속성 (칼럼) | Sort.by(direstion, properties)에 의해 정렬 |

